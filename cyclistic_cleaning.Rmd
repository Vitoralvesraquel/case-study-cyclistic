---
title: "Cyclistic Data Cleaning"
author: "Vitor Alves Raquel"
date: '2022-06-14'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE}
setwd("/home/vitor/RStudio-projects/case-study-cyclistic")
Sys.setlocale("LC_ALL", "C")
```


```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
```

Make a list of the csv files inside the directory with original data.
Apply read_csv function to all files in the list.

```{r message=FALSE}
full_df_list <- list.files(path = "Data/Original", pattern = ".csv", 
                      full.names = TRUE, recursive = TRUE) %>% 
    lapply(read_csv)
```

Count total number of rows in the list.

```{r}
sum_rows_list <- sum(sapply(full_df_list, nrow))
sum_rows_list
```

Combine all data from the list. Compare the number of rows in the list with the
number of rows in the new dataframe to verify that all rows were combined.

```{r}
full_df <- bind_rows(full_df_list)
sum_rows_list == nrow(full_df)

```
Remove list from memory since it will not be used from now on.
```{r}
rm(full_df_list)
```

View columns data types and first rows.

```{r}
glimpse(full_df)
```
Check for NAs.

```{r}
colSums(is.na(full_df))
```
Count unique values for ride_id and compare with number of rows to check for 
duplicates.

```{r}
length(unique(full_df$ride_id)) == sum_rows_list
```

Create columns for trip duration, month_year, day, weekday.

```{r}
full_df <- full_df %>% 
    mutate(trip_duration = as.duration(ended_at - started_at),
           month_year = format(started_at, "%Y-%m"),
           day = day(started_at),
           weekday = wday(started_at, label = TRUE))
unique(full_df$month_year)
```


View data summary to check for anything unusual.

```{r}
summary(full_df)
```

The trip duration column shows some problems. The minimum value is negative and 
maximum is in weeks, which is too big. 
Values smaller than 1 minute will also be disconsidered, since they could represent false starts.
Values larger than 1 day will also be discarded.

```{r}
full_df <- full_df[full_df$trip_duration > 60 & full_df$trip_duration < 86400,]
summary(full_df$trip_duration)
```




